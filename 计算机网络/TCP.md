# TCP #
TCP（传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。

UDP和TCP很相似，但是更简单，同时可靠性低于TCP。

## 作用 ##
- 保证数据通信的完整性和可靠性，防止丢包。

## TCP数据包的编号 ##
一个包1400字节，那么一次性发送大量数据，就必须分成多个包。比如，一个10MB的文件，需要发送7100多个包。

发送的时候，TCP协议为每个包编号，以便接收的一方按照顺序还原。万一发生丢包，也可以知道丢失的是哪一个包。

每个数据包都可以得到两个编号：自身的编号，以及下一个包的编号。

## 慢启动和ACK ##
TCP协议为了做到效率与可靠性的统一，设计了一个慢启动机制。开始的时候，发送得较慢，然后根据丢包的情况，调整速率：如果不丢包，就加快发送速度；如果丢包，就降低发送速度。

默认情况下，接收方每收到两个TCP数据包，就要发送一个确认消息。这个确认消息简称为ACK。

ACK携带的信息

- 期待要收到下一个数据包的编号
- 接收方的接收窗口的剩余容量

发送方有了这两个信息，再加上自己已经发出的数据包的最新编号，就会推测出接收方大概的接收速度，从而降低或增加发送速率。

## 三次握手 ##
第一次：客户端-->服务器 此时服务器知道了客户端要建立连接了

第二次：客户端<--服务器 此时客户端知道服务器收到连接请求了

第三次：客户端-->服务器 此时服务器知道客户端收到了自己的回应

到这里，就可以认为客户端与服务器已经建立了连接

刚开始，客户端和服务器都处于CLOSE状态。  
此时，客户端向服务器主动发出连接请求，服务器被动接受连接请求。

1. TCP服务器进程先创建**传输控制块TCB**，时刻准备接受客户端进程的连接请求，此时服务器就进入了**LISTEN（监听）**状态
2. TCP客户端进程也是先创建传输控制块TCB，然后向服务器发出连接请求报文，此时报文首部中的同步标志位**SYN=1**，同时选择一个初始序列号**seq=x**，此时，TCP客户端进程进入了 **SYN-SENT（同步已发送状态）**状态。TCP规定，SYN报文（SYN=1的报文段）不能携带数据，但需要消耗一个序号。
3. TCP服务器收到请求报文后，如果同意连接，则发出确认报文。确认报文中的**ACK=1，SYN=1，确认序号是x+1**，同时也要为自己初始化一个序列号**seq=y**，此时，TCP服务器进程进入了 **SYN-RCVD（同步收到）**状态。这个报文也不能携带数据，但是同样要消耗一个序号。
4. TCP客户端进程收到确认后还要向服务器给出确认。确认报文的**ACK=1，确认序号是y+1，自己的序列号是x+1**。
5. 此时，TCP连接建立，客户端进入**ESTABLISHD（已建立连接）**状态。当服务器收到客户端的确认后也进入**ESTABLISHED**状态，此后双方就可以开始通信了。

## 四次挥手 ##
