# HTTP #
HTTP协议解决文件传输的问题。HTTP是应用层协议。
HTTP是基于传输层TCP协议的，而TCP是一个端到端的面向连接的协议。所谓的端到端可以理解为进程到进程之间的通信。所以HTTP在开始传输之前，首先需要建立TCP连接，而TCP连接的过程需要所谓的“三次握手”。

HTTP是一种不保存状态，即无状态协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。这是为了更快地处理大量事务，确保协议的可伸缩性，而特意把HTTP协议设计成如此简单的。

> HTTP/1.1虽然是无状态协议，但为了实现期望的保持状态功能，于是引入了Cookie技术。有了Cookie再用HTTP协议通信，就可以管理状态了。

## 简单三次握手 ##
![](https://i.imgur.com/E18Hj9k.png)

![](https://i.imgur.com/3m5vEGl.png)

![](https://i.imgur.com/H08B9wh.png)
## HTTP请求 ##
所谓的HTTP请求，也就是Web客户端向Web服务器发送信息，这个信息由如下三部分组成：

1. 请求行：只有一行
2. HTTP头：可以有多行，每一行是一对键值对。 
	- 请求头（request header）
	- 普通头（general header）
	- 实体头（entity header）
3. 内容（只在POST请求中存在）

一个典型的请求行比如：

	GET www.baidu.com HTTP/1.1
方法、资源的路径、协议的版本、可选的请求首部字段和内容实体构成。

请求首部字段：

	Host: hackr.jp
	Connection: keep-alive
	Content-Type: application/x-www-form-urlencoded
	Content-Length: 16

内容实体：

	name=ueno&age=37

## HTTP请求方法 ##
- GET：从指定的资源请求数据
- POST：向指定的资源提交要被处理的数据
- PUT：传输文件

	就像FTP协议的文件上传一样，要求在请求报文的主体中包含文件内容，然后保存到请求URI指定的位置。
- DELETE：删除文件

	是与PUT相反的方法。DELETE方法按请求URI删除指定的资源。
- HEAD：请求响应报文首部

	和GET一样，但不返回报文主体。用于确认URI的有效性及资源更新的日期时间等。
- OPTIONS：返回请求的资源所支持的方法的方法
- CONNECT：要求用隧道协议连接代理

	CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL和TLS协议把通信内容加密后经网络隧道传输。

	格式：
		
		CONNECT 代理服务器名:端口号 HTTP版本
- TRACE：追踪路径

	TRACE方法是让Web服务器端将之前通信环回给客户端的方法。

	发送请求时，在Max-Forwards首部字段中填入数值，每经过一个服务器端就将该数字减1，当数值刚好减到0时，就停止继续传输，最后接收到请求的服务端则返回状态码200 OK的响应。

	客户端通过TRACE方法可以查询发送出去的请求是怎样被加工修改/篡改的。这是因为，请求想要连接到源目标服务器可能会通过代理中转，TRACE方法就是用来确认连接过程中发生的一系列操作。

	TRACE方法容易引发XST（Cross-Site Tracing，跨站追踪）攻击。


方法名区分大小写，注意要用大写字母。

![](https://i.imgur.com/65JlR5I.png)
### 比较GET与POST ###
GET方法：

- 查询字符串（名称/值对）是在GET请求的URL中发送的。
- GET请求可被缓存
- GET请求保留在浏览器历史记录中
- GET请求可被收藏为书签
- GET请求不应在处理敏感数据时使用
- GET请求只应当于取回数据

POST方法：

- 查询字符串（名称/值对）是在POST请求的HTTP消息主体中发送的。
- POST请求不会被缓存
- POST请求不会保留在浏览器历史记录中
- POST不能被收藏为书签
- POST请求对数据长度没有要求

![](https://i.imgur.com/t2MQWbq.png)

参考文章：

- [GET和POST两种基本请求方法的区别](https://www.cnblogs.com/logsharing/p/8448446.html)

## 指定请求URI ##
### 方法一 URI为完整的请求URI ###
	GET http://hackr.jp/index.htm HTTP/1.1
### 方法二 在首部字段Host中写明网络域名或IP地址 ###
	GET /index.htm HTTP/1.1
	Host: hackr.jp
### 其他 ###
除此之外，如果不是访问特定资源而是对服务器本身发起请求，可以用一个`*`来代替请求URI。

例子：查询HTTP服务器端支持的HTTP方法种类

	OPTIONS * HTTP/1.1
## HTTP响应 ##
1. 状态行
2. HTTP头
	- 请响应头（response header）
	- 普通头（general header）
	- 实体头（entity header）
3. 返回内容

一个典型的HTTP状态如下：

	HTTP/1.1 200 OK
第一部分是HTTP版本，第二部分是响应状态码，第三部分是状态码的描述（原因短语）。

	HTTP/1.1 200 OK
	Date: Tue, 10 Jul 2012 06:50:15 GMT	
	Content-Length: 362
	Content-Type: text/html

	<html>
	...

显示了创建响应的日期时间，是首部字段内的一个属性。接着以一空行分隔，之后的内容称为资源实体的主体

> 响应报文基本上由协议版本、状态码（表示请求成功或失败的数字代码）、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

## HTTP状态码分类 ##
- 信息类（100-199）
- 响应成功（200-299）
- 重定向类（300-399）
- 客户端错误类（400-499）
- 服务端错误类（500-599）


----------
当我们在浏览器的地址栏输入www.linux178.com，然后回车，回车这一瞬间到看到页面到底发生了什么呢？

域名解析 --> 发去TCP的3次握手 --> 建立TCP连接后发起http请求 --> 服务器响应http请求，浏览器得到html代码 --> 浏览器解析html代码，并请求html代码中的资源（如js、css、图片等） --> 浏览器对页面进行渲染呈现给用户

### 域名解析 ###
1. 搜索浏览器自身的DNS缓存[chrome://net-internals/#dns](chrome://net-internals/#dns)
2. 操作系统自身的DNS缓存 `ipconfig /displaydns`
3. 尝试读取hosts文件（位于C:\windows\System32\drivers\etc)
4. 向本地配置的首选DNS服务器发起域名解析请求。。。

参考文章：

- [一次完整的HTTP事务是怎样一个过程？](http://blog.51cto.com/linux5588/1351007)

## 持久连接 ##
持久连接的特点是，只要任意一端没有明确提出断开连接，则保持TCP连接状态。持久连接旨在建立1次TCP连接后进行多次请求和响应的交互。

持久连接的好处在于减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。

在HTTP/1.1中，所有的连接默认都是持久连接，但在HTTP/1.0内并未标准化。

## 管线化 ##
不用等待响应亦可直接发送下一个请求。这样就能够做到同时并行发送多个请求，而不需要一个接一个地等待响应了。

## HTTP报文 ##
用于HTTP协议交互的信息被称为HTTP报文。HTTP报文本身是由多行（用CR+LF作换行符）数据构成的字符串文本。

HTTP报文大致可分为报文首部和报文主体两块。两者由最初出现的空行（CR+LF）来划分。通常，并不一定要有报文主体。

报文首部：服务器端或客户端需处理的请求或响应的内容及属性。

![](https://i.imgur.com/y2qliqT.png)

![](https://i.imgur.com/1DDjQF0.png)

- 请求行：包含用于请求的方法，请求URI和HTTP版本。
- 状态行：包含表明响应结果的状态码，原因短语和HTTP版本。
- 首部字段：包含表示请求和响应的各种条件和属性的各类首部。
	- 通用首部
	- 请求首部
	- 响应首部
	- 实体首部
- 其他：可能包含HTTP的RFC里未定义的首部（Cookie等）。

## 报文主体和实体主体 ##
- 报文：是网络中交换和传输的数据单元。即站点一次性要发送的数据块。报文包含了将要发送的完整的数据信息。
- 实体：作为请求或响应的有效载荷数据（补充项）被传输，其内容由实体主体组成。

![](https://i.imgur.com/vwVatz5.png)

我们可以看到，上面示例右图中深红色框的内容就是报文的实体部分，而蓝色框的两部分内容就是实体首部和实体主体。而左图中粉红色框内容就是报文主体。通常，**报文主体等于实体主体。只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。**

## 内容编码 ##
内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

常用的内容编码有以下几种。

- gzip（GNU zip）
- compress（UNIX系统的标准压缩）
- deflate（zlib）
- identity（不进行编码）

## 分块传输编码 ##
分块传输编码会将实体主体分成多个部分（块）。每一块都会用十六进制来标记块的大小，而实体主体的最后一块会使用“0(CR+LF)”来标记。

## 多部分对象集合 ##
MIME：多用途因特网邮件扩展。允许邮件处理文本、图片、视频等多个不同类型的数据。MIME扩展中会使用一种称为多部分对象集合（Multipart）的方法，来容纳多份不同类型的数据。

- multipart/form-data
- multipart/byteranges

在HTTP报文中使用多部分对象集合时，需要在首部字段里加上`Content-type`。使用`boundary`字符串来划分多部分对象集合指明的各类实体。在`boundary`字符串指定的各个实体的起始行之前插入`--`标记（例如：`--AaB03x`、`--THIS_STRING_SEPARATES`），而在多部分对象集合对应的字符串的最后插入`--`标记。
